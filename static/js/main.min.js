function ajaxSend(e,t,n,r,a,i){var o={url:e,data:t||"",type:r||"POST",success:n,error:function(){alert("Request failed, please try again."),stop_loading("loading")},return_type:a||"json",cache:!1,global:!0,ajax_func_flag:!1,custom_func:n};if(i)for(var l in i)o[l]=i[l];$.ajax(o)}function init(){jQuery.fn.extend({render:function(e){$(this).load(e,function(){$(".z").hide()})},centerWindow:function(){var e=$(window).width(),t=$(window).height(),n=e-$(this).width()>0?(e-$(this).width())/2:0,r=t-$(this).height()>0?(t-$(this).height())/2:0;$(this).css({left:n,top:r}),$(".z").show(),$(this).removeClass("sZoom").addClass("sZoom").show()}}),jQuery.extend({hideWindow:function(){$(".window-base").hide(),$(".z").hide()}})}function ajaxFileUpload(e,t,n){var r=new FormData;r.append("file",t);var a=new XMLHttpRequest;a.open("post",e,!0),a.onload=function(e){var t=JSON.parse(e.target.responseText),r=t.msg;t.errcode||n(),alert(r)},a.send(r)}function uploadProgress(e){var t=document.getElementById("progressBar"),n=document.getElementById("percentage");e.lengthComputable&&(t.max=e.total,t.value=e.loaded,n.innerHTML=Math.round(e.loaded/e.total*100)+"%")}function expand_ztree(e){var t=$.fn.zTree.getZTreeObj(e);t.expandAll(!0)}function close_ztree(e){var t=$.fn.zTree.getZTreeObj(e),n=t.getNodes();for(var r in n)t.expandNode(n[r],!1,!0,!1)}function search_ztree(e,t){searchByFlag_ztree(e,t,"")}function searchByFlag_ztree(e,t,n){var r=[],a=$.fn.zTree.getZTreeObj(e);for(var i in t){var o=a.getNodesByParam("rev_id",t[i],null);if(o.length>0)for(var l in o)r.push(o[l])}highlightAndExpand_ztree(e,r,n)}function highlightAndExpand_ztree(e,t,n){for(var r=$.fn.zTree.getZTreeObj(e),a=r.transformToArray(r.getNodes()),i=0;i<a.length;i++)a[i].highlight=!1,r.updateNode(a[i]);if(null!==t)for(var i=0;i<t.length;i++){{expandParentNodes_ztree(e,t[i])}null!==n&&""!==n?t[i].highlight==n&&(t[i].highlight=!0,r.updateNode(t[i]),expandParentNodes_ztree(e,t[i])):(t[i].highlight=!0,r.updateNode(t[i]),expandParentNodes_ztree(e,t[i]))}}function getParentNodes_ztree(e,t){if(null!==t){var r=($.fn.zTree.getZTreeObj(e),t.getParentNode());return getParentNodes_ztree(e,r)}return t}function expandParentNodes_ztree(e,t){for(;t;){var n=$.fn.zTree.getZTreeObj(e),r=t.getParentNode();n.expandNode(t,!0,!1,!0),t=r}}function getParentRevIds(e){for(var t={},n=e.getParentNode();n;)t[n.node_type]=n.rev_id,n=n.getParentNode();return t}function setFontCss_ztree(e,t){return 0===t.id?{color:"#333","font-weight":"bold"}:t.isParent===!1?t.highlight?{color:"green","font-weight":"bold"}:{color:"","font-weight":"normal"}:t.highlight?{color:"green","font-weight":"bold"}:{color:"","font-weight":"normal"}}function loading(e){$("#"+e).show();var t={lines:12,length:7,width:5,radius:10,corners:1,rotate:0,direction:1,color:"white",speed:1,trail:100,shadow:!0,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"};if(1==$("#"+e).children().length)$("#"+e).show();else{var n=document.getElementById(e),r=new Spinner(t);r.spin(n)}}function stop_loading(e){$("#"+e).hide()}function start_spin(e,t){var n={lines:12,length:7,width:5,radius:10,corners:1,rotate:0,direction:1,color:t,speed:1,trail:100,shadow:!0,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},r=document.getElementById(e),a=new Spinner(n);return a.spin(r),a}function add_data_validate(){$("#detail-table").on("keyup","input[name='QTY']",function(){this.value=this.value.replace(/\D/g,"")}),$("#detail-table").on("afterpaste","input[name='QTY']",function(){this.value=this.value.replace(/\D/g,"")}),$("#detail-table").on("keyup","input[name='Customer #']",function(){this.value=this.value.replace(/\D/g,"")}),$("#detail-table").on("afterpaste","input[name='Customer #']",function(){this.value=this.value.replace(/\D/g,"")}),$("#detail-table").on("blur","input[name='SNX Part']",function(){handleTBD(this);var e=this.id.replace(" ","\\ "),t=$("#"+e).width();ajaxSend("validate_part",{type:"snx_part",value:this.value},function(n){validate_part_no(e,n,t)})})}function validate_part_no(e,t){if(t)$("#"+e).next().length>0&&($("#"+e).next().remove(),$("#"+e).width("90%"));else if(0===$("#"+e).next().length){var r="<span class='glyphicon glyphicon-exclamation-sign' title='Warning: Cannot find this part# in CIS'></span>";$("#"+e).parent().append(r),$("#"+e).width("80%")}}function refreshTree(e,t,n,r,a,i){ajaxSend(e,t,function(e){if(e.errcode)alert(e.msg);else{var t=$.fn.zTree.getZTreeObj(n);if(t.destroy(),t=$.fn.zTree.init($("#"+n),r,e.data),a>0){var o=t.getNodeByParam("rev_id",a),l=o.getParentNode();t.expandNode(l),t.selectNode(o),i&&$("#"+o.tId+"_a").click()}else window.location="/"}stop_loading("loading")})}function beforeDrag(e,t){for(var n in t)if("platform"==t[n].node_type)return!0;return!1}function beforeDragOpen(e,t){return"archive"==t.node_type||"customer"==t.node_type?!0:!1}function beforeDrop(e,t,n,r){return"inner"==r&&("archive"==n.node_type&&n.rev_id==t[0].customer_id||"customer"==n.node_type&&n.rev_id==t[0].customer_id)?!0:!1}function treeOnDrop(e,t,n,r){var i=n[0].rev_id,o=r.node_type;ajaxSend("on_drag",{rev_id:i,target:o},function(){return!1})}function saveColumnWidth(e,t){var n=$("#detail-table").getGridParam("colModel")[t].name,r="detail_table_column_width_{0}_{1}".format(node_type,n);$.cookie(r,e,{expires:365})}function saveColumnWidth_bu(e,t){var n=$("#parts-table").getGridParam("colModel")[t].name,r="batch_update_column_width_{0}".format(n);$.cookie(r,e,{expires:365})}function getColumnWidth(e,t){var n=$.cookie("detail_table_column_width_{0}_{1}".format(e,t));return n&&(n=parseInt(n)),n}function getColumnWidth_bu(e){var t=$.cookie("batch_update_column_width_{0}".format(e));return t&&(t=parseInt(t)),t}function move_up(e){var t=$(e).closest("tr"),n=t.prev();t.index()>1&&t.insertBefore(n)}function move_down(e){var t=$(e).closest("tr"),n=t.next();n&&t.insertAfter(n)}function move_TBD(e){var a,t=$(e).closest("tr"),n=$("#detail-table").getDataIDs(),r="";for(var i in n)if("TBD"!=$("#"+n[i]).find("input[name='SNX Part']").val().replace(/\./g,"")){r=n[i],a=i;break}a<n.indexOf(t.prop("id"))&&(t.insertBefore($("#"+r)),t.focus())}function handleTBD(e){var t=$(e).closest("tr").attr("id");"TBD"==e.value.replace(/\./g,"")?(move_TBD(e),"bom"==node_type&&setEditable(t,["MFG Part#","Description","Unit Cost","Vendor"],!0)):"bom"==node_type&&setEditable(t,["MFG Part#","Description","Unit Cost","Vendor"],!1)}function key_navigation(e){$("#detail-table").on("keydown",e,function(e){if(e.ctrlKey){var t=e.target;switch(e.key){case"Right":var n=$(t).closest("td").nextAll();for(var r in n)if($(n[r]).children().length>0){var a=$(n[r]).find("input");if(!a.attr("readonly")){a.focus();break}}break;case"Left":var i=$(t).closest("td").prevAll();for(var r in i)if($(i[r]).children().length>0){var a=$(i[r]).find("input");if(!a.attr("readonly")){a.focus();break}}break;case"Up":var o=$(t).prop("name").replace(" ","\\ ").replace("#","\\#").replace("/","\\/"),l=$(t).closest("tr").prev().prop("id");""!==l&&$("#"+l+"_"+o).parent().find("input").focus();break;case"Down":var o=$(t).prop("name").replace(" ","\\ ").replace("#","\\#").replace("/","\\/"),s=$(t).closest("tr").next().prop("id");""!==s&&$("#"+s+"_"+o).parent().find("input").focus()}}})}function setEditable(e,t,n){var r;for(var a in t)r=$("#"+e).find("input[name='{0}']".format(t[a])),n?(r.removeAttr("readonly"),r.removeClass("no-border"),"Vendor"==r.attr("name")&&r.width("60%"),r.next().css("display","")):(r.attr("readonly",""),r.addClass("no-border"),"Vendor"==r.attr("name")&&r.width("90%"),r.next().css("display","none"))}function get_batch_update_detail(){for(var e={},t=$("#update-detail input"),n=0;n<t.length;n++)e[t[n].name]=t[n].value==t[n].name?"":t[n].value;return e}String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(t,n){return e[n]})},function(e){e.widget("custom.combobox",{_create:function(){this.wrapper=e("<span>").addClass("custom-combobox").insertAfter(this.element),this.element.hide(),this._createAutocomplete(),this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.children(":selected"),n=t.val()?t.text():"";this.input=e("<input>").appendTo(this.wrapper).val(n).attr("title","").addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:e.proxy(this,"_source")}).tooltip({tooltipClass:"ui-state-highlight"}),this._on(this.input,{autocompleteselect:function(e,t){t.item.option.selected=!0,this._trigger("select",e,{item:t.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var t=this.input,n=!1;e("<a>").attr("tabIndex",-1).tooltip().appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").mousedown(function(){n=t.autocomplete("widget").is(":visible")}).click(function(){t.focus(),n||t.autocomplete("search","")})},_source:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(t.term),"i");n(this.element.children("option").map(function(){var n=e(this).text();return!this.value||t.term&&!r.test(n)?void 0:{label:n,value:n,option:this}}))},_removeIfInvalid:function(t,n){if(!n.item){var r=this.input.val(),a=r.toLowerCase(),i=!1;this.element.children("option").each(function(){return e(this).text().toLowerCase()===a?(this.selected=i=!0,!1):void 0}),i||(this.input.attr("title",r+" didn't match any item").tooltip("open"),this._delay(function(){this.input.tooltip("close").attr("title","")},2500),this.input.autocomplete("instance").term="")}},_destroy:function(){this.wrapper.remove(),this.element.show()}})}(jQuery);